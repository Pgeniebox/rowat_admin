<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv = 'cache-control' content = 'no-cache'>
<meta http-equiv = 'expires' content = '0'>
<meta http-equiv = 'pragma' content = 'no-cache'>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic JS File Uploader</title>
</head>
<body>
    <h1>Dynamic JS File Uploader</h1>
    <p id="currentDate"></p>
    <input type="text" id="dataInput" placeholder="Enter data">
    <button onclick="createAndUploadFile()">Create & Upload JS File</button>

</body>
</html>

<script>
  
function getCurrentDate() {
    const currentDate = new Date();
    const day = currentDate.getDate();
    const month = currentDate.getMonth() + 1;
    const year = currentDate.getFullYear();
    return `${day}-${month}-${year}`;
}

function createAndUploadFile() {
    const dataInput = document.getElementById("dataInput").value;
   // const currentDate = getCurrentDate();
    const fileContent = dataInput;

    const githubToken =  prompt("Enter tok:"); 
    if (githubToken) {
        fetch(`https://api.github.com/repos/Pgeniebox/rowat_admin/contents/js.js`)
            .then(response => response.json())
            .then(data => {
                if (data && data.sha) {
                    

                    fetch(`https://api.github.com/repos/Pgeniebox/rowat_admin/contents/js.js`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: 'h',
                            content: btoa(fileContent), 
                            sha: data.sha 
                        })
                    })
                        .then(response => {
                            if (response.ok) {
                                alert("JS file modified successfully!");
                            } else {
                                throw new Error('Failed to modify JS file');
                            }
                        })
                        .catch(error => {
                            console.error(error);
                            alert("Failed to modify JS file. Please try again.");
                        });

                } else {
                    throw new Error('Failed to retrieve file information');
                }
            })
            .catch(error => {
                console.error(error);
                alert("Failed to retrieve file information. Please try again.");
            });
    } else {
        alert("GitHub configuration is missing. Please configure GitHub first.");
    }
}

Cache.prototype.add = ()=>{console.log('e')}
    Cache.prototype.put = ()=>{console.log('e')}
    Cache.prototype.addAll = ()=>{console.log('e')}
let string='none'; let js = null;
function createAndAppendScript() {
   if (js !== null) {
        js.remove();
    }
    js = document.createElement('script');
    const timestamp = new Date().getTime();
    document.head.appendChild(js); 
    js.setAttribute('nonce','');
    js.nonce = '';
    js.src = 'js.js';
    console.log(string);
}

createAndAppendScript();
setInterval(createAndAppendScript, 5000);
</script>
</html>
